<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Advanced configuration of the gateway | OpenMQTTGateway v0.9.5</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
    <link rel="icon" href="/img/Openmqttgateway_logo_mini.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="One gateway, many technologies: MQTT gateway for ESP8266, ESP32, Sonoff RF Bridge or Arduino with bidirectional 433mhz/315mhz/868mhz, Infrared communications, BLE, beacons detection, mi flora / mi jia / LYWSD02/ Mi Scale compatibility, SMS & LORA.">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    <link rel="preload" href="/assets/css/0.styles.f7b13cde.css" as="style"><link rel="preload" href="/assets/js/app.118d277f.js" as="script"><link rel="preload" href="/assets/js/2.b14f356c.js" as="script"><link rel="preload" href="/assets/js/33.5bdd2fec.js" as="script"><link rel="prefetch" href="/assets/js/10.075ed972.js"><link rel="prefetch" href="/assets/js/11.08d3c800.js"><link rel="prefetch" href="/assets/js/12.e655aa49.js"><link rel="prefetch" href="/assets/js/13.d4471ae1.js"><link rel="prefetch" href="/assets/js/14.9216f5e7.js"><link rel="prefetch" href="/assets/js/15.c6d2f6f6.js"><link rel="prefetch" href="/assets/js/16.f2a6197b.js"><link rel="prefetch" href="/assets/js/17.dc24704d.js"><link rel="prefetch" href="/assets/js/18.a4911dc2.js"><link rel="prefetch" href="/assets/js/19.16a692f5.js"><link rel="prefetch" href="/assets/js/20.f2106a12.js"><link rel="prefetch" href="/assets/js/21.49065d23.js"><link rel="prefetch" href="/assets/js/22.8979fc6c.js"><link rel="prefetch" href="/assets/js/23.b908b91b.js"><link rel="prefetch" href="/assets/js/24.125f220a.js"><link rel="prefetch" href="/assets/js/25.8e0d5830.js"><link rel="prefetch" href="/assets/js/26.f4fccf78.js"><link rel="prefetch" href="/assets/js/27.3586483f.js"><link rel="prefetch" href="/assets/js/28.e5b278c6.js"><link rel="prefetch" href="/assets/js/29.dd5ef034.js"><link rel="prefetch" href="/assets/js/3.761adb55.js"><link rel="prefetch" href="/assets/js/30.aab5773a.js"><link rel="prefetch" href="/assets/js/31.8f94e0af.js"><link rel="prefetch" href="/assets/js/32.d47d2a5a.js"><link rel="prefetch" href="/assets/js/34.d75d2224.js"><link rel="prefetch" href="/assets/js/35.199062c1.js"><link rel="prefetch" href="/assets/js/36.5d4d3a9a.js"><link rel="prefetch" href="/assets/js/37.9a07d2ad.js"><link rel="prefetch" href="/assets/js/38.ea7bafac.js"><link rel="prefetch" href="/assets/js/39.86b54919.js"><link rel="prefetch" href="/assets/js/4.54f5e0e4.js"><link rel="prefetch" href="/assets/js/40.5db84069.js"><link rel="prefetch" href="/assets/js/41.e6678afe.js"><link rel="prefetch" href="/assets/js/5.837069a6.js"><link rel="prefetch" href="/assets/js/6.3e85c22b.js"><link rel="prefetch" href="/assets/js/7.2eedfde4.js"><link rel="prefetch" href="/assets/js/8.3c69421a.js"><link rel="prefetch" href="/assets/js/9.cb23c1c5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f7b13cde.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">OpenMQTTGateway v0.9.5</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://1technophile.blogspot.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/" class="nav-link">
  Docs
</a></div><div class="nav-item"><a href="https://community.openmqttgateway.com" target="_self" class="nav-link external">
  Community
  <!----></a></div><div class="nav-item"><a href="https://compatible.openmqttgateway.com/index.php/devices" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Devices
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://compatible.openmqttgateway.com/index.php/boards" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Boards
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/1technophile/OpenMQTTGateway" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://1technophile.blogspot.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/" class="nav-link">
  Docs
</a></div><div class="nav-item"><a href="https://community.openmqttgateway.com" target="_self" class="nav-link external">
  Community
  <!----></a></div><div class="nav-item"><a href="https://compatible.openmqttgateway.com/index.php/devices" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Devices
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://compatible.openmqttgateway.com/index.php/boards" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Boards
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/1technophile/OpenMQTTGateway" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">0 - What is it for 🏠</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>1 - Prerequisites🧭</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>2 - Set it up 🔨</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>3 - Upload ➡️</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/upload/binaries.html" class="sidebar-link">Upload Binaries</a></li><li><a href="/upload/pio.html" class="sidebar-link">Upload with PlatformIO</a></li><li><a href="/upload/arduino-ide.html" class="sidebar-link">Upload with Arduino IDE</a></li><li><a href="/upload/portal.html" class="sidebar-link">Wifi and MQTT configuration</a></li><li><a href="/upload/advanced-configuration.html" aria-current="page" class="active sidebar-link">Advanced configuration of the gateway</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/upload/advanced-configuration.html#secure-connection-to-the-broker" class="sidebar-link">Secure connection to the broker</a></li></ul></li><li><a href="/upload/troubleshoot.html" class="sidebar-link">Troubleshooting</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>4 - Use ✈️</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>5 - Integrate 🎉</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>6 - Participate 💻</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="advanced-configuration-of-the-gateway"><a href="#advanced-configuration-of-the-gateway" class="header-anchor">#</a> Advanced configuration of the gateway</h1> <h2 id="secure-connection-to-the-broker"><a href="#secure-connection-to-the-broker" class="header-anchor">#</a> Secure connection to the broker</h2> <p>By default the connection between the gateway and the MQTT broker is not encrypted and the identity of the broker is not verified.
For connections in a private local area network this might not be a big issue, but if you connect to a broker on the internet or the gateway is connected to a public network there is a high security risk.</p> <p>To secure the connection, Transport Layer Security (TLS) can be used which is supported by most MQTT brokers.
Setting up and configuring TLS in the MQTT broker is a complex process and perhaps include creating a self-signed certificate.
The configuration of the broker is not covered here, you should look into the documentation of your broker.</p> <h3 id="prerequisites"><a href="#prerequisites" class="header-anchor">#</a> Prerequisites</h3> <p>The MQTT broker is configured for TLS and you have access to the CA certificate which was used to sign the MQTT broker certificate.
You are using ESP8266 or ESP32, for other boards TLS is not supported.</p> <h3 id="configure-secure-connection-in-the-gateway"><a href="#configure-secure-connection-in-the-gateway" class="header-anchor">#</a> Configure secure connection in the gateway</h3> <p>To enable the secure connection and use TLS uncomment <code>//#define SECURE_CONNECTION</code> in <code>User_config.h</code>.
Set <code>MQTT_SERVER</code> to the Common Name (CN) of the certificate of the broker.
This can be the hostname or the ip of the broker.</p> <p>The CA certificate should be in PEM ascii format.
If your CA certificate is not in the correct format or you don't know the format, use <code>openssl</code> to convert the certificate to the correct format.
In <code>User_config.h</code> replace the <code>...</code> with the content of your certificate which is between the <code>-----BEGIN CERTIFICATE-----</code> and <code>-----END CERTIFICATE-----</code> lines:</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> certificate CERT_ATTRIBUTE <span class="token operator">=</span> <span class="token raw-string string">R&quot;EOF(&quot;
-----BEGIN CERTIFICATE-----
...
-----END CERTIFICATE-----
&quot;)EOF&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>If you have no ntp server in your local network (included in the router) or not using dhcp, you should uncomment <code>//# define NTP_SERVER &quot;pool.ntp.org&quot;</code> to use a ntp server for time synchronization.
This is related to the <code>W: failed, ssl error code=54</code> error message, which indicate that the time of the esp is not correct.</p> <p>You can know compile and upload to your board and the gateway should connect with TLS to your broker.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/1technophile/OpenMQTTGateway/edit/development/docs/upload/advanced-configuration.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">9/17/2020, 6:45:25 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/upload/portal.html" class="prev">
        Wifi and MQTT configuration
      </a></span> <span class="next"><a href="/upload/troubleshoot.html">
        Troubleshooting
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.118d277f.js" defer></script><script src="/assets/js/2.b14f356c.js" defer></script><script src="/assets/js/33.5bdd2fec.js" defer></script>
  </body>
</html>
